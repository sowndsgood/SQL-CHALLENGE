--Find Product Prices on a Specific Date

CREATE TABLE Products (
 ProductID INT,
 ChangeDate DATE,
 Price INT
);

INSERT INTO Products (ProductID, ChangeDate, Price) VALUES
(1, '2019-08-14', 15),
(2, '2019-08-15', 20),
(1, '2019-08-16', 17),
(2, '2019-08-17', 25),
(3, '2019-08-18', 30);

SELECT * FROM PRODUCTS;

WITH LATESTPRICE AS
(
SELECT PRODUCTID,
COALESCE(MAX(PRICE) FILTER(WHERE CHANGEDATE<='2019-08-16'),10) AS PRICE
FROM PRODUCTS
GROUP BY PRODUCTID
)

SELECT *
FROM LATESTPRICE
ORDER BY PRODUCTID




